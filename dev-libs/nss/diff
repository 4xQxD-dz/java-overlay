--- nss-3.15.5.ebuild	2014-03-14 23:28:13.402236131 +0000
+++ nss-3.16.ebuild	2014-03-24 15:01:11.000000000 +0000
@@ -1,6 +1,6 @@
 # Copyright 1999-2014 Gentoo Foundation
 # Distributed under the terms of the GNU General Public License v2
-# $Header: /var/cvsroot/gentoo-x86/dev-libs/nss/nss-3.15.5.ebuild,v 1.1 2014/02/22 10:42:36 polynomial-c Exp $
+# $Header: /var/cvsroot/gentoo-x86/dev-libs/nss/nss-3.16.ebuild,v 1.8 2014/03/24 14:33:48 ago Exp $
 
 EAPI=5
 inherit eutils flag-o-matic multilib toolchain-funcs
@@ -19,8 +19,8 @@
 
 LICENSE="|| ( MPL-2.0 GPL-2 LGPL-2.1 )"
 SLOT="0"
-KEYWORDS="~alpha ~amd64 ~arm ~arm64 ~hppa ~ia64 ~m68k ~mips ~ppc ~ppc64 ~s390 ~sh ~sparc ~x86 ~amd64-fbsd ~x86-fbsd ~amd64-linux ~x86-linux ~x86-macos ~sparc-solaris ~x64-solaris ~x86-solaris"
-IUSE="+cacert +java +nss-pem utils"
+KEYWORDS="alpha amd64 arm ~arm64 hppa ~ia64 ~m68k ~mips ppc ppc64 ~s390 ~sh ~sparc x86 ~amd64-fbsd ~x86-fbsd ~amd64-linux ~x86-linux ~x86-macos ~sparc-solaris ~x64-solaris ~x86-solaris"
+IUSE="+cacert +nss-pem utils"
 
 DEPEND="virtual/pkgconfig
 	>=dev-libs/nspr-${NSPR_VER}"
@@ -49,7 +49,6 @@
 	epatch "${FILESDIR}/${PN}-3.15-gentoo-fixup-warnings.patch"
 	use cacert && epatch "${DISTDIR}/${PN}-3.14.1-add_spi+cacerts_ca_certs.patch"
 	use nss-pem && epatch "${FILESDIR}/${PN}-3.15.4-enable-pem.patch"
-	epatch "${FILESDIR}/${PN}-3.15-x32.patch"
 	epatch "${FILESDIR}/nss-3.14.2-solaris-gcc.patch"
 	cd coreconf
 	# hack nspr paths
@@ -151,13 +150,12 @@
 	XCFLAGS="${BUILD_CFLAGS}" \
 	emake -j1 -C coreconf \
 		CC="${BUILD_CC}" \
-		$(nssbits BUILD_) \
-		|| die
+		$(nssbits BUILD_)
 	makeargs+=( NSINSTALL="${PWD}/$(find -type f -name nsinstall)" )
 
 	# Then build the target tools.
 	for d in . lib/dbm ; do
-		emake -j1 "${makeargs[@]}" -C ${d} || die "${d} make failed"
+		emake -j1 "${makeargs[@]}" -C ${d}
 	done
 }
 
@@ -216,28 +214,16 @@
 	# We generate these after stripping the libraries, else they don't match.
 	#cp -L */lib/*.chk "${ED}"/usr/$(get_libdir) || die "copying chk files failed"
 	cp -L */lib/libcrmf.a "${ED}"/usr/$(get_libdir) || die "copying libs failed"
-	if use java ; then
-	  cp -L */lib/lib{softokn,freebl}.a "${ED}"/usr/$(get_libdir) || die "copying libs failed"
-	fi
 
 	# Install nss-config and pkgconfig file
 	dodir /usr/bin
 	cp -L */bin/nss-config "${ED}"/usr/bin
 	dodir /usr/$(get_libdir)/pkgconfig
 	cp -L */lib/pkgconfig/nss.pc "${ED}"/usr/$(get_libdir)/pkgconfig
-	if use java ; then
-		local javapc="${ED}"/usr/$(get_libdir)/pkgconfig/nss{,-java}.pc
-		cp -L "${ED}"/usr/$(get_libdir)/pkgconfig/nss.pc ${javapc}
-		sed -i -e 's#Libs:#Libs: -lfreebl -lsoftokn#' -e 's#Cflags:#Cflags: -I${includedir}/private#' ${javapc}
-	fi
 
 	# all the include files
 	insinto /usr/include/nss
 	doins public/nss/*.h
-	if use java ; then
-	  insinto /usr/include/nss/private
-	  doins private/nss/{softoken,lowkeyti,softoknt,blapi,alghmac}.h
-	fi
 
 	local f nssutils
 	# Always enabled because we need it for chk generation.
