<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link title="new" rel="stylesheet" href="css/main.css" type="text/css">
<link REL="shortcut icon" HREF="http://www.gentoo.org/favicon.ico" TYPE="image/x-icon">
<title>Gentoo Linux Documentation
--
  Tomcat Guide</title>
</head>
<body style="margin:0px;" bgcolor="#ffffff"><table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td valign="top" height="125" bgcolor="#45347b"><a href="http://www.gentoo.org/"><img border="0" src="images/gtop-www.jpg" alt="Gentoo Logo"></a></td></tr>
<tr><td valign="top" align="right" colspan="1" bgcolor="#ffffff"><table border="0" cellspacing="0" cellpadding="0" width="100%"><tr>
<td width="99%" class="content" valign="top" align="left">
<br><h1>Tomcat Guide</h1>
<form name="contents" action="http://www.gentoo.org">
<b>Content</b>:
        <select name="url" size="1" OnChange="location.href=form.url.options[form.url.selectedIndex].value" style="font-family:sans-serif,Arial,Helvetica"><option value="#doc_chap1">1. Introduction</option>
<option value="#doc_chap2">2. Layout</option>
<option value="#doc_chap3">3. Installation</option>
<option value="#doc_chap4">4. Usage</option>
<option value="#doc_chap5">5. Future</option>
<option value="#doc_chap6">6. Problems</option></select>
</form>
<p class="chaphead"><span class="chapnum"><a name="doc_chap1">1. </a></span>Introduction</p>
        <p>
	      Some aspects of Tomcat on Gentoo are slightly different than how upstream
	      handles it. This document aims to provide some information on how it differs.
          This document is based on Tomcat versions 5.0.28, 5.5.x and later. Older
          versions of Tomcat should not be used, as it is discouraged by upstream.
          Which includes Tomcat 5.0.28. Only use that version if your application requires
          it. Otherwise please use 5.5.x or later when released.
        </p>
        <p>
          The biggest initial difference on Gentoo is Tomcat being spread across 
          multiple directories. That is because applications on Gentoo strive to
          comply FHS, in addition to Gentoo-specific standards. 
        </p>
        <p>
          Another major differences is that Tomcat is compiled from source,
          along with the latest versions of any dependencies and bundled libraries,
          which will also be compiled from source.  
        </p>
        <p>
	  There are a number of smaller details, which will be covered in detail soon.
        </p>
        <p>
          This document will not cover <a href="http://java.sun.com/products/servlet/">
          Java Servlet Specifications</a>, nor general
          <a href="http://tomcat.apache.org/">Tomcat configuration</a>.
          This document assumes the reader has a basic understanding of what a Java
          Web Application is, consists of, and basics of how to configure a container for the
          web application. 
        </p>
      <p class="chaphead"><span class="chapnum"><a name="doc_chap2">2. </a></span>Layout</p>
<p class="secthead"><a name="doc_chap2_sect1">Standard Tomcat Layout</a></p>
        <p>
          The root directory of a typical Tomcat binary distribution is laid out as illustrated
          in the following listing.
        </p>
        <a name="doc_chap2_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 2.1: Standard Tomcat Root Directory Layout</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
/opt/tomcat-x.y/bin
/opt/tomcat-x.y/common
/opt/tomcat-x.y/conf
/opt/tomcat-x.y/logs
/opt/tomcat-x.y/server
/opt/tomcat-x.y/shared
/opt/tomcat-x.y/temp
/opt/tomcat-x.y/webapps
/opt/tomcat-x.y/work
        </pre></td></tr>
</table>
      	<table class="ncontent" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#bbffbb"><p class="note"><b>Note: </b>
	      Substitute either 5.0 or 5.5 for x.y
	    </p></td></tr></table>
      <p class="secthead"><a name="doc_chap2_sect2">Gentoo Tomcat Layout</a></p>
        <p>
          To comply with FHS and Gentoo standards, Tomcat has been dissected 
	  and installed into the following locations.
        </p>
        <a name="doc_chap2_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 2.2: Gentoo Tomcat Layout</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
/usr/share/tomcat-x.y/bin
/usr/share/tomcat-x.y/common
/etc/tomcat-x.y
/var/log/tomcat-x.y/logs
/usr/share/tomcat-x.y/server
/var/lib/tomcat-x.y/shared
/var/tmp/tomcat-x.y
/var/lib/tomcat-x.y/webapps
/var/run/tomcat-x.y
</pre></td></tr>
</table>
      <p class="secthead"><a name="doc_chap2_sect3">Configuration Files</a></p>
        <p>
          In addition to simply moving the Tomcat <span class="path">/conf</span> directory under
         <span class="path">/etc</span>. There is a Gentoo-specific Tomcat configuration file
         <span class="path">etc/conf.d/tomcat-x.y</span>, which contains Tomcat variables that are
         sourced by <span class="path">/etc/init.d/tomcat-x.y</span>. These variables are:
        </p>
        <dl>
          <dd>
            <ul>
              <li>
        	    JAVA_HOME: default is to be set to <span class="code">$(java-config --jdk-home)</span>. Changing this
                variable allows Tomcat to run with a VM other than the system VM
              </li>
              <li>
        	    CATALINA_HOME: default is <span class="path">/usr/share/tomcat-x.y</span>
              </li>
              <li>
        	    CATALINA_BASE: default is <span class="path">/var/lib/tomcat-x.y</span>
              </li>
              <li>
        	    CATALINA_USER: default is tomcat
              </li>
              <li>
        	    CATALINA_LIBDIR: default is typically 
                <span class="path">/usr/share/tomcat-x.y/server/lib</span>
              </li>
              <li>
        	    CLASSPATH: default is <span class="code">${CATALINA_LIBDIR}</span>
              </li>
              <li>
        	    CATALINA_TMPDIR: default is <span class="path">/var/tmp/tomcat-*</span>
              </li>
              <li>
        	    TOMCAT_START: default is "start", with alternatives being "debug", 
                "start -security", "debug -security", or "jpda start"
              </li>
              <li>
        	    TOMCAT_STOP: default is "stop"
              </li>
              <li>
        	    CATALINA_OPTS: not set by default , can be used to pass options to Java or Tomcat
              </li>
            </ul>
          </dd>
        </dl>
        <p>
	      The Gentoo init script is also installed into <span class="path">/etc</span>, at
          <span class="path">/etc/init.d/tomcat-x.y</span> . Tomcat on Gentoo no longer uses
          or modifies catalina.sh.
        </p>
      <p class="secthead"><a name="doc_chap2_sect4">Web Applications</a></p>
        <p>
          The <span class="path">/var/lib/tomcat-x.y/</span> contains a symlinks to other Tomcat directories, and the <span class="path">webapps/</span>
          directory where actual web applications go. This directory serves as
          the hub and is referenced by Tomcat as the TOMCAT_BASE.
        </p>
        <a name="doc_chap2_pre3"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 2.3: Gentoo Tomcat Base and webapp location</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
conf -&gt; /etc/tomcat-x.y
logs -&gt; /var/log/tomcat-x.y
shared
temp -&gt; /var/tmp/tomcat-x.y
webapps
work -&gt; /var/run/tomcat-x.y</pre></td></tr>
</table>
      <p class="secthead"><a name="doc_chap2_sect5">Runtime Files</a></p>
        <p>
          These directories hold logs, temp, and working files used by Tomcat.
        </p>
        <dl>
          <dd>
            <ul>
              <li>
        	    <span class="path">/var/tmp/tomcat-x.y</span> Tomcat's temporary directory
              </li>
              <li>
        	    <span class="path">/var/run/tomcat-x.y</span> Tomcat's working directory,
		    where  JSPs Java sources and resulting class files live
              </li>
              <li>
        	    <span class="path">/var/log/tomcat-x.y</span> Tomcat's logging directory
              </li>
            </ul>
          </dd>
        </dl>
      <p class="chaphead"><span class="chapnum"><a name="doc_chap3">3. </a></span>Installation</p>
<p class="secthead"><a name="doc_chap3_sect1">Tomcat's USE flags</a></p>
        <p>
          Tomcat's USE flags are not any different from USE flags for any package on
          Gentoo. Most are self-explanatory like doc, sources, and test. They are for documentation, 
          sources, and running unit tests, correspondingly.
        </p>

        <p>
          The examples USE flag should be used for anyone new to Tomcat,
          Java Web Application development, or just about anything beyond 
	  deploying existing applications. When set, the examples USE flag
	  will install the example web applications, which includes the default
	  'Tomcat is running', and web based documentation. Without the
          examples USE flag set, any request to <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>
	  will result with a blank page. This would be desired if Tomcat is a 
	  dependency for other wanted Java applications, where the examples
	  will not be used. Most all can safely ignore this USE flag, unless you are starting out.
        </p>
      <p class="secthead"><a name="doc_chap3_sect2">Emerge Tomcat</a></p>
        <p>
          Once you have the desired USE flags set in <span class="path">/etc/make.conf</span>
	  or <span class="path">/etc/portage/package.use</span> it's
          time to actually install Tomcat. Tomcat, like every other package on Gentoo, is installed by doing:
        </p>
        <a name="doc_chap3_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 3.1: Command to download, compile, and install Tomcat</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
emerge tomcat</pre></td></tr>
</table>
        <table class="ncontent" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#ffbbbb"><p class="note"><b>Warning: </b>
          Because Tomcat is compiled from source, along with all its
	  dependencies, a lot of packages may be pulled in at emerge time.
          Good news is, since it's Java, aside from download time, should
          compile rather quickly even on older machines.
        </p></td></tr></table>
      <p class="chaphead"><span class="chapnum"><a name="doc_chap4">4. </a></span>Usage</p>
<p class="secthead"><a name="doc_chap4_sect1">Configuring Tomcat</a></p>
        <p>
          Depending on what Tomcat will be used for, one may or may not need to
          finely configure Tomcat. If Tomcat is just a dependency of another
	  application, one might be able to simple start
          Tomcat, and request the application via a browser or etc at
          http://127.0.0.1:8080/.
        </p>
        <p>
          For most others, particularly developers, running more than one site under Tomcat, or etc.  will need to edit Tomcat's main configuration file
          <span class="path">/etc/tomcat-x.y/server.xml</span>. The syntax of that file,
	  and configuration of Tomcat is beyond the scope of this document.
	  Please refer to
          <a href="http://tomcat.apache.org/">Tomcat documentation</a>
          for more information.
        </p>
      <p class="secthead"><a name="doc_chap4_sect2">Using a Specific VM</a></p>
        <p>
          By default, Tomcat will use the system VM controlled by
	  <span class="code">java-config</span> as-per the JAVA_HOME variable in
	  <span class="path">/etc/conf.d/tomcat-x.y</span>. One can
          change that variable to point to any VM that is capable of
	  running Tomcat. Then, when Tomcat is started, it will use the
	  specified VM.
        </p>
      <p class="secthead"><a name="doc_chap4_sect3">Logging</a></p>
        <p>
          With 5.5.x Logging has changed a bit. Tomcat no longer uses log4j by default.
          Applications can still use log4j, however the jars have to be put onto the classpath manually.
          Log4j is not used by a Tomcat install by default, same as upstream. For more
          information please refer to Tomcat's documentation on logging. Despite this
          change log4j is still a compile time dependency for now.
          <a href="http://jakarta.apache.org/commons/logging/tech.html">http://jakarta.apache.org/commons/logging/tech.html</a>
        </p>
        <table class="ncontent" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#ffbbbb"><p class="note"><b>Warning: </b>
         log4j.ar MUST be in the same directory as commons-logging.jar. The lowest 
         classloader level they should be put in is common/lib. The recommended is
         shared/lib, or in a specific webapp's WEB-INF/lib directory.
        </p></td></tr></table>
      <p class="secthead"><a name="doc_chap4_sect4">Starting/Stopping Tomcat</a></p>
        <p>
          Tomcat is started and stopped the same as any service on Gentoo.
        </p>
        <a name="doc_chap4_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 4.1: Start Stop Restart Tomcat</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
/etc/init.d/tomcat-x.y [ start | stop | restart ]</pre></td></tr>
</table>
      <p class="secthead"><a name="doc_chap4_sect5">Tomcat's Standard Web Applications</a></p>
        <p>
          By default we do not install Tomcat's examples web application. We
	  do , however, install Tomcat's admin and manager applications.
	  However per upstream Tomcat policy, no usernames or passwords are
	  configured by default. <span class="path">/etc/tomcat-x.y/tomcat-users.xml</span>
	  should be modified to add users
        </p>
        <a name="doc_chap4_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td bgcolor="#7a5ada"><p class="codetitle">Code Listing 4.2: Admin and Manager Web Application URLs</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
http://127.0.0.1:8080/manager/html/
http://127.0.0.1:8080/admin/</pre></td></tr>
</table>
      <p class="secthead"><a name="doc_chap4_sect6">Missing Jar - naming-factory-dbcp.jar</a></p>
        <p>
          Currently the naming-factory-dbcp.jar is not build by default. To build that jar
          Tomcat robs .java source files from 3 other commons packages, collections, 
          pool, and dbcp. There is no clean solution to compiling this jar at this time.
          Suggestions, patches, or any assistance on compiling that jar is greatly 
          appreciated.
        </p>
        <table class="ncontent" width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td bgcolor="#bbffbb"><p class="note"><b>Note: </b>
          For the time being anyone who needs that jar should fetch it from a binary release
          of Tomcat 5.0.x or 5.5.x. Just place the jar into common/lib and you will be all set.
        </p></td></tr></table>
      <p class="chaphead"><span class="chapnum"><a name="doc_chap5">5. </a></span>Future</p>
<p class="secthead"><a name="doc_chap5_sect1">Future possibilities for Tomcat on Gentoo</a></p>
        <p>
          These are some features which are either in consideration, under development, 
          or are only a dream. Ideally to be implemented in the order listed below.
        </p>
        <dl>
          <dd>
            <ul>
              <li>
                Migrate ebuild to generation 2 Java system to support compiling Tomcat with 
                &gt;=1.5 JDK's. This has been deferred so a current version of Tomcat can be
                added to arch/stable tree ASAP. Once Tomcat makes it out of ~arch, the
                ebuild will be migrated to generation 2, and can be compiled with 1.5 jdk.
                <br>
                <a href="http://bugs.gentoo.org/show_bug.cgi?id=139215">http://bugs.gentoo.org/show_bug.cgi?id=139215</a>
              </li>
              <li>
                Add USE flag to control admin app compilation/installation. Since Tomcat 5.5,
                the admin webapp is not included anymore by default. The admin webapp is what
                causes struts to be a dependency. This use flag will make the struts
                dependency
              </li>
              <li>
                Documentation on Tomcat's connectors and using them to connect to
                Apache on Gentoo Linux.
              </li>
              <li>
        	    Replace init script with one developed by a Tomcat developer<br>
               <a href="http://www.webdroid.org:8080/repo/viewcvs.cgi/tomcat-package/trunk/bin/">http://www.webdroid.org:8080/repo/viewcvs.cgi/tomcat-package/trunk/bin/</a>
              </li>
              <li>
        	    Modify Tomcat init script or ebuild to use JSVC so Tomcat can run on 
        	    unprivileged ports. This might not happen, as in there are other ways to do
        	    this. We are working with upstream on this but are far from an ideal solution.
                <br>
                <a href="http://bugs.gentoo.org/show_bug.cgi?id=75224">http://bugs.gentoo.org/show_bug.cgi?id=75224</a>
              </li>
              <li>
        	    Gentoo Web Application integration support per
              <a href="http://www.gentoo.org/proj/en/glep/glep-0011.html">GLEP 11</a>
              </li>
            </ul>
          </dd>
        </dl>
      <p class="chaphead"><span class="chapnum"><a name="doc_chap6">6. </a></span>Problems</p>
<p class="secthead"><a name="doc_chap6_sect1">Where and who to report what to</a></p>
        <p>
          If you have problems, please stop and think if the problem is
	  Gentoo related, or Tomcat specific. If you are not sure, please start
	  with the Gentoo Java community and Team, which can be reached via
	  the gentoo-java mailing list, or
          #gentoo-java IRC channel on irc.freenode.net. Please file and
	  report Gentoo related bugs, feature enhancement requests, and etc to
          <a href="http://bugs.gentoo.org/">http://bugs.gentoo.org/</a>
        </p>
      <br><p class="copyright">
    The contents of this document are licensed under the <a href="http://creativecommons.org/licenses/by-sa/2.5">Creative Commons -
    Attribution / Share Alike</a> license.
  </p>
<!--
  <rdf:RDF xmlns="http://web.resource.org/cc/"
      xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
  <License rdf:about="http://creativecommons.org/licenses/by-sa/2.5/">
     <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
     <permits rdf:resource="http://web.resource.org/cc/Distribution" />
     <requires rdf:resource="http://web.resource.org/cc/Notice" />
     <requires rdf:resource="http://web.resource.org/cc/Attribution" />
     <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
     <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
  </License>
  </rdf:RDF>
--><br>
</td>
<td width="1%" bgcolor="#dddaec" valign="top"><table border="0" cellspacing="4px" cellpadding="4px">
<tr><td align="center" class="topsep"><p class="alttext">Updated July 16, 2006</p></td></tr>
<tr><td align="left" class="topsep"><p class="alttext"><b>Summary: </b>
    This guide provides information on the layout, usage, and other things related to
    Tomcat version 5.0.28, 5.5.x and later on Gentoo Linux.
  </p></td></tr>
<tr><td align="left" class="topsep"><p class="alttext">
    <b><a class="altlink" href="mailto:wlt@obsidian-studios.com">William L. Thomson Jr.</a></b>
  <br><i>Author</i><br><br>
    <b><a class="altlink" href="mailto:nichoj@gentoo.org">Joshua Nichols</a></b>
  <br><i>Editor</i><br></p></td></tr>
<tr lang="en"><td align="center" class="topsep">
<p class="alttext"><b>Donate</b> to support our development efforts.
        </p>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_xclick"><input type="hidden" name="business" value="paypal@gentoo.org"><input type="hidden" name="item_name" value="Gentoo Linux Support"><input type="hidden" name="item_number" value="1000"><input type="hidden" name="image_url" value="/images/paypal.png"><input type="hidden" name="no_shipping" value="1"><input type="hidden" name="return" value="http://www.gentoo.org"><input type="hidden" name="cancel_return" value="http://www.gentoo.org"><input type="image" src="http://images.paypal.com/images/x-click-but21.gif" name="submit" alt="Make payments with PayPal - it's fast, free and secure!">
</form>
</td></tr>
<tr><td align="center" class="topsep"></td></tr>
</table></td>
</tr></table></td></tr>
<tr><td colspan="2" align="right" class="infohead">
      Copyright 2001-2006 Gentoo Foundation.
    </td></tr>
</table></body>
</html>
